<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drone</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">


    <style>
        /* –°—Ç–∏–ª—ñ –¥–ª—è –≥–∞—Ä–Ω–æ–≥–æ –≤–∏–≥–ª—è–¥—É */
        .table-container { width: 100%; overflow-x: auto; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; position: sticky; top: 0; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó */
        .pagination { display: flex; gap: 5px; margin-top: 10px; }
        .page-btn { padding: 8px 12px; cursor: pointer; border: 1px solid #ccc; background: white; }
        .page-btn.active { background-color: #007bff; color: white; border-color: #007bff; }
    </style>

</head>

<body>

<header>

    <nav class="menu">

        <div>
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo demchenko-livandovska" width="50px"
                 style="margin-left: 10px;">
        </div>

        <div>
            <ul class="first_ul">
                <li class="first_li"><a class="first_a" href="#Dowland">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</a></li>
                <li class="first_li"><a class="first_a" href="#Form">–§–æ—Ä–º–∞</a></li>
                <li class="first_li"><a class="first_a" href="#End">–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤</a></li>
            </ul>
        </div>

    </nav>

</header>

<section class="navigation_on_foto">

    <h1>–î–æ—Å—Ç–∞–≤–∫–∞ –¥—Ä–æ–Ω–∞–º–∏</h1>

</section>

<main class="content-wrapper">

    <div class="upload-container">

        <a name="Dowland"></a>

        <h1 style="font-size: 34px; margin-bottom: 20px; text-shadow: 2px 2px 10px #da7762">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö</h1>

        <p>–í–∏–±–µ—Ä—ñ—Ç—å –≤–∞—à CSV-—Ñ–∞–π–ª –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ –±–∞–∑—É SQLite:</p>

        <form action="/upload" method="POST" enctype="multipart/form-data">

            <div id="drop-zone" class="drop-zone">

                <span class="drop-zone__prompt">
                    üíæ –ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å CSV-—Ñ–∞–π–ª —Å—é–¥–∏<br>–∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É
                </span>

                <span id="file-name-display" class="drop-zone__file-name">–ù–∞–∑–≤–∞ —Ñ–∞–π–ª—É</span>

                <input type="file" name="file" accept=".csv" id="file-input" hidden>

            </div>

            <button type="submit">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –≤ SQL</button>

        </form>

    </div>

    <script>

        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const prompt = document.querySelector('.drop-zone__prompt');
        const fileNameDisplay = document.getElementById('file-name-display');

        // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –≤–∏–±—ñ—Ä —Ñ–∞–π–ª—É –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –∑–æ–Ω—É
        dropZone.addEventListener('click', () => fileInput.click());

        // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è, –∫–æ–ª–∏ —Ñ–∞–π–ª –≤–∏–±—Ä–∞–Ω–æ —á–µ—Ä–µ–∑ –¥—ñ–∞–ª–æ–≥
        fileInput.addEventListener('change', (e) => {
            if (fileInput.files.length) {
                updateFileNameDisplay(fileInput.files[0].name);
            }
        });

        // –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–¥—ñ—ó Drag & Drop

        // 1. –§–∞–π–ª –Ω–∞–¥ –∑–æ–Ω–æ—é
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault(); // –û–±–æ–≤'—è–∑–∫–æ–≤–æ! –ó–∞–±–æ—Ä–æ–Ω—è—î –±—Ä–∞—É–∑–µ—Ä—É –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ —Ñ–∞–π–ª
            dropZone.classList.add('drag-over');
        });

        // 2. –§–∞–π–ª –≤–∏–π—à–æ–≤ —ñ–∑ –∑–æ–Ω–∏
        ['dragleave', 'dragend'].forEach(type => {
            dropZone.addEventListener(type, () => {
                dropZone.classList.remove('drag-over');
            });
        });

        // 3. –§–∞–π–ª "–≤–ø–∞–≤" —É –∑–æ–Ω—É
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault(); // –ó–∞–±–æ—Ä–æ–Ω—è—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –¥—ñ—é
            dropZone.classList.remove('drag-over');

            if (e.dataTransfer.files.length) {
                const file = e.dataTransfer.files[0];

                // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤ JavaScript (—á–∏ —Ü–µ CSV)
                if (file.name.endsWith('.csv')) {
                    fileInput.files = e.dataTransfer.files; // –ü–µ—Ä–µ–¥–∞—î–º–æ —Ñ–∞–π–ª —É —Å—Ö–æ–≤–∞–Ω–∏–π input
                    updateFileNameDisplay(file.name);
                } else {
                    alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ª–∏—à–µ CSV-—Ñ–∞–π–ª.");
                }
            }
        });

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–∞–∑–≤–∏ —Ñ–∞–π–ª—É
        function updateFileNameDisplay(fileName) {
            prompt.style.opacity = '0'; // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Ç–µ–∫—Å—Ç

            setTimeout(() => {
                prompt.style.display = 'none';
                fileNameDisplay.textContent = 'üìÑ ' + fileName; // –î–æ–¥–∞—î–º–æ —ñ–∫–æ–Ω–∫—É
                fileNameDisplay.style.display = 'block';
                setTimeout(() => {
                    fileNameDisplay.style.opacity = '1';
                }, 10);
            }, 300); // –ß–∞—Å –∞–Ω—ñ–º–∞—Ü—ñ—ó –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è
        }

    </script>

    <div class="upload-container">

        <a name="Form"></a>
        <h2 style="font-size: 34px; margin-bottom: 20px; text-shadow: 2px 2px 10px #da7762">–ó–∞–ø–æ–≤–Ω—ñ —Ñ–æ—Ä–º—É </h2>

        <form action="/submit_form" method="POST">

            <div class="form-group">
                <label for="longitude">–î–æ–≤–≥–æ—Ç–∞:</label>
                <input type="text" id="longitude" name="longitude" required placeholder="–í–≤–µ–¥—ñ—Ç—å –¥–æ–≤–≥–æ—Ç—É">
            </div>

            <div class="form-group">
                <label for="width">–®–∏—Ä–∏–Ω–∞:</label>
                <input type="text" id="width" name="width" required placeholder="–í–≤–µ–¥—ñ—Ç—å —à–∏—Ä–∏–Ω—É">
            </div>

            <div class="form-group">
                <label for="sum">–°—É–º–∞:</label>
                <input type="text" id="sum" name="sum" required placeholder="–í–≤–µ–¥—ñ—Ç—å —Å—É–º—É">
            </div>
            <button type="submit">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>

        </form>

    </div>

    <div class="table_csv">

        <a name="End"></a>
        {{ table | safe if table }}
    </div>

    <div class="table_csv">
        <h3>–Ü—Å—Ç–æ—Ä—ñ—è —Ä—É—á–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤</h3>
        {{ history_table | safe if history_table }}
    </div>

</main>

<footer class="main-footer">
    <br>
    <h2 style="color: white; text-align: center;">–ú–∏ —Å—Ç—É–¥–µ–Ω—Ç–∫–∏ –í—ñ–Ω–Ω–∏—Ü—å–∫–æ–≥–æ –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Ö–Ω—ñ—á–Ω–æ–≥–æ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É</h2>
    <div style="display: flex; justify-content: center;">
        <p style="margin-left: 20px; margin-right: 20px; color: white; ">
            –°—Ç–≤–æ—Ä–µ–Ω–∞ —Ä–æ–±–æ—Ç–∞ –±—É–ª–∞ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∞ –¥–ª—è —É—á–∞—Å—Ç—ñ —É —Ö–∞–∫–∞—Ç–æ–Ω—ñ.
        </p>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

<script>

    $(document).ready(function() {

        var table = $('table');

        if (table.length > 0) {
            table.attr('id', 'resultTable');
            table.addClass('display');

            $('#resultTable').DataTable({
                "pageLength": 10,
                "scrollX": true,
                "language": {
                    "url": "https://cdn.datatables.net"
                }
            });
            console.log("–ü–∞–≥—ñ–Ω–∞—Ü—ñ—è –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!");
        }
    });
</script>

</body>

</html>